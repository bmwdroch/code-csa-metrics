{% extends "base.html" %}

{% block title %}CSQA Метрики — Анализ безопасности кода{% endblock %}

{% block content %}
<div class="page-wrap page-center">

  <!-- Brand header -->
  <div style="margin-bottom: 1.5rem; animation: slide-up-fade 0.5s cubic-bezier(0.16,1,0.3,1) both;">
    <h1 style="font-size: 1.75rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 0.25rem;">
      CSQA <span style="color: var(--accent);">МЕТРИКИ</span>
    </h1>
    <p style="font-size: 0.8125rem; color: var(--text-tertiary); line-height: 1.4;">
      Статический анализ безопасности Java-репозиториев
    </p>
  </div>

  <!-- Error alert -->
  {% if error %}
  <div class="alert alert-danger" style="max-width: 560px;">
    {{ error }}
  </div>
  {% endif %}

  <!-- Analysis form -->
  <div class="card-hud accent-border accent-glow" style="width: 100%; max-width: 560px;">
    <span class="corner tl"></span><span class="corner tr"></span>
    <span class="corner bl"></span><span class="corner br"></span>

    <div class="card-label" style="margin-bottom: 1.25rem;">Цель анализа</div>

    <form method="POST" action="{{ url_prefix }}/run" id="analysis-form">

      <!-- Repository URL -->
      <div class="input-field" style="margin-bottom: 1.5rem;">
        <label class="input-label" for="repo_url">URL репозитория GitHub</label>
        <div style="display: flex; gap: 0.5rem; align-items: stretch;">
          <input
            type="url"
            id="repo_url"
            name="repo_url"
            class="input-control"
            placeholder="https://github.com/owner/repository"
            pattern="https?://github\.com/[\w.\-]+/[\w.\-]+.*"
            required
            autocomplete="url"
            spellcheck="false"
            style="flex: 1;"
          >
          <button
            type="button"
            id="example-btn"
            class="btn-clipped"
            style="white-space: nowrap; font-size: 0.6875rem; padding: 0 1rem;"
          >Пример</button>
        </div>
        <p class="input-hint">Только Java-проекты · Публичные репозитории</p>
      </div>

      <!-- Submit -->
      <button
        type="submit"
        id="submit-btn"
        class="btn-3d btn-3d--clipped btn-3d--primary"
        style="width: 100%; justify-content: center; font-size: 0.75rem;"
      >
        <span class="btn-3d__text-wrapper">
          <span class="btn-3d__text btn-3d__text--front">Анализировать репозиторий</span>
          <span class="btn-3d__text btn-3d__text--back">Запуск&nbsp;→</span>
        </span>
      </button>

    </form>
  </div>


</div>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById('example-btn').addEventListener('click', function () {
    document.getElementById('repo_url').value = 'https://github.com/WebGoat/WebGoat';
  });

  // Disable submit button after first click to prevent double-submission
  document.getElementById('analysis-form').addEventListener('submit', function () {
    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.style.opacity = '0.5';
  });
</script>
{% endblock %}
